<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extension API &mdash; hls4ml 0.6.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_contributors.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="hls4ml.backends package" href="../autodoc/hls4ml.backends.html" />
    <link rel="prev" title="FIFO Buffer Depth Optimization" href="fifo_depth.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html">
            
              <img src="../_static/hls4ml_logo_navbar.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.6.0.dev227+gfcdfae3a
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status and Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command.html">Command Line Interface (deprecated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../details.html">Backends and I/O Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flows.html">Optimizer Passes and Flows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Citation and Contributors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/hls-model.html">HLS Model Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/profiling.html">Profiling</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="fifo_depth.html">FIFO Buffer Depth Optimization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Extension API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#complete-example">Complete example</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Autogenerated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/hls4ml.backends.html">hls4ml.backends package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/hls4ml.converters.html">hls4ml.converters package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/hls4ml.model.html">hls4ml.model package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/hls4ml.report.html">hls4ml.report package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/hls4ml.utils.html">hls4ml.utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/hls4ml.writer.html">hls4ml.writer package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hls4ml</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Extension API</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/fastmachinelearning/hls4ml/blob/main/docs/advanced/extension.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="extension-api">
<h1>Extension API<a class="headerlink" href="#extension-api" title="Permalink to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">hls4ml</span></code> natively supports a large number of neural network layers.
But what if a desired layer is not supported?
If it is standard enough and its implementation would benefit the community as a whole, we would welcome a contribution to add it to the standard set of supported layers.
However, if it is a somewhat niche custom layer, there is another approach we can take to extend hls4ml through the <em>extension API</em>.</p>
<p>This documentation will walk through a complete <a class="reference external" href="https://github.com/fastmachinelearning/hls4ml/blob/main/test/pytest/test_extensions.py">complete end-to-end example</a>, which is part of our testing suite.
To implement a custom layer in <code class="docutils literal notranslate"><span class="pre">hls4ml</span></code> with the extension API, the required components are:</p>
<ul class="simple">
<li><p>Your custom layer class</p></li>
<li><p>Equivalent hls4ml custom layer class</p></li>
<li><p>Parser for the converter</p></li>
<li><p>HLS implementation</p></li>
<li><p>Layer config template</p></li>
<li><p>Function config template</p></li>
<li><p>Registration of layer, source code, and templates</p></li>
</ul>
<section id="complete-example">
<h2>Complete example<a class="headerlink" href="#complete-example" title="Permalink to this heading"></a></h2>
<p>For concreteness, let’s say our custom layer <code class="docutils literal notranslate"><span class="pre">KReverse</span></code> is implemented in Keras and reverses the order of the last dimension of the input.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Keras implementation of a custom layer</span>
<span class="k">class</span> <span class="nc">KReverse</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Keras implementation of a hypothetical custom layer&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>We can define the equivalent layer in hls4ml <code class="docutils literal notranslate"><span class="pre">HReverse</span></code>, which inherits from <code class="docutils literal notranslate"><span class="pre">hls4ml.model.layers.Layer</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># hls4ml layer implementation</span>
<span class="k">class</span> <span class="nc">HReverse</span><span class="p">(</span><span class="n">hls4ml</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;hls4ml implementation of a hypothetical custom layer&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_input_variable</span><span class="p">()</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">dim_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output_variable</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
</pre></div>
</div>
<p>A parser for the Keras to HLS converter is also required.
This parser reads the attributes of the Keras layer instance and populates a dictionary of attributes for the hls4ml layer.
It also returns a list of output shapes (one sjape for each output).
In this case, there a single output with the same shape as the input.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parser for converter</span>
<span class="k">def</span> <span class="nf">parse_reverse_layer</span><span class="p">(</span><span class="n">keras_layer</span><span class="p">,</span> <span class="n">input_names</span><span class="p">,</span> <span class="n">input_shapes</span><span class="p">,</span> <span class="n">data_reader</span><span class="p">):</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">layer</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HReverse&#39;</span>
    <span class="n">layer</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keras_layer</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">layer</span><span class="p">[</span><span class="s1">&#39;n_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">input_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">layer</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_names</span>

    <span class="k">return</span> <span class="n">layer</span><span class="p">,</span> <span class="p">[</span><span class="n">shape</span> <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">input_shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
<p>Next, we need the actual HLS implementaton of the function, which can be written in a header file <code class="docutils literal notranslate"><span class="pre">nnet_reverse.h</span></code>.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef NNET_REVERSE_H_</span>
<span class="cp">#define NNET_REVERSE_H_</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;nnet_common.h&quot;</span><span class="cp"></span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">nnet</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">reverse_config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">n_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">data_T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">CONFIG_T</span><span class="o">&gt;</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="n">reverse</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">data_T</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">CONFIG_T</span><span class="o">::</span><span class="n">n_in</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="n">data_T</span><span class="w"> </span><span class="n">reversed</span><span class="p">[</span><span class="n">CONFIG_T</span><span class="o">::</span><span class="n">n_in</span><span class="p">]</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">CONFIG_T</span><span class="o">::</span><span class="n">n_in</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">reversed</span><span class="p">[</span><span class="n">CONFIG_T</span><span class="o">::</span><span class="n">n_in</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="cp">#endif</span>
</pre></div>
</div>
<p>Now, we can define the layer config and function call templates.
These two templates determine how to populate the config template based on the layer attributes and the function call signature for the layer in HLS, respectively.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">rev_config_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;struct config</span><span class="si">{index}</span><span class="s2"> : nnet::reverse_config {{</span>
<span class="s2">    static const unsigned n_in = </span><span class="si">{n_in}</span><span class="s2">;</span>
<span class="s2">}};</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

<span class="n">rev_function_template</span> <span class="o">=</span> <span class="s1">&#39;nnet::reverse&lt;</span><span class="si">{input_t}</span><span class="s1">, </span><span class="si">{config}</span><span class="s1">&gt;(</span><span class="si">{input}</span><span class="s1">, </span><span class="si">{output}</span><span class="s1">);&#39;</span>
<span class="n">rev_include_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nnet_utils/nnet_reverse.h&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">HReverseConfigTemplate</span><span class="p">(</span><span class="n">hls4ml</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">LayerConfigTemplate</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">HReverse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">rev_config_template</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_config_params</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HReverseFunctionTemplate</span><span class="p">(</span><span class="n">hls4ml</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">FunctionCallTemplate</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">HReverse</span><span class="p">,</span> <span class="n">include_header</span><span class="o">=</span><span class="n">rev_include_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">rev_function_template</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_function_params</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we need to tell hls4ml about the existence of this new layer by registering it.
We also need to register the parser (a.k.a. the layer handler), the template passes, and HLS implementation source code with the particular backend.
In this case, the HLS code is valid for both the Vivado and Quartus backends.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Register the converter for custom Keras layer</span>
<span class="n">hls4ml</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">register_keras_layer_handler</span><span class="p">(</span><span class="s1">&#39;KReverse&#39;</span><span class="p">,</span> <span class="n">parse_reverse_layer</span><span class="p">)</span>

<span class="c1"># Register the hls4ml&#39;s IR layer</span>
<span class="n">hls4ml</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">register_layer</span><span class="p">(</span><span class="s1">&#39;HReverse&#39;</span><span class="p">,</span> <span class="n">HReverse</span><span class="p">)</span>

<span class="k">for</span> <span class="n">backend_id</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Vivado&#39;</span><span class="p">,</span> <span class="s1">&#39;Quartus&#39;</span><span class="p">]:</span>
    <span class="c1"># Register the optimization passes (if any)</span>
    <span class="n">backend</span> <span class="o">=</span> <span class="n">hls4ml</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="n">backend_id</span><span class="p">)</span>
    <span class="n">backend</span><span class="o">.</span><span class="n">register_pass</span><span class="p">(</span><span class="s1">&#39;remove_duplicate_reverse&#39;</span><span class="p">,</span> <span class="n">RemoveDuplicateReverse</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">backend_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">:optimize&#39;</span><span class="p">)</span>

    <span class="c1"># Register template passes for the given backend</span>
    <span class="n">backend</span><span class="o">.</span><span class="n">register_template</span><span class="p">(</span><span class="n">HReverseConfigTemplate</span><span class="p">)</span>
    <span class="n">backend</span><span class="o">.</span><span class="n">register_template</span><span class="p">(</span><span class="n">HReverseFunctionTemplate</span><span class="p">)</span>

    <span class="c1"># Register HLS implementation</span>
    <span class="n">backend</span><span class="o">.</span><span class="n">register_source</span><span class="p">(</span><span class="s1">&#39;nnet_reverse.h&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we can actually test the <code class="docutils literal notranslate"><span class="pre">hls4ml</span></code> custom layer compared to the Keras one.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test if it works</span>
<span class="n">kmodel</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,)),</span>
        <span class="n">KReverse</span><span class="p">(),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
<span class="n">kres</span> <span class="o">=</span> <span class="n">kmodel</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">for</span> <span class="n">backend_id</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Vivado&#39;</span><span class="p">,</span> <span class="s1">&#39;Quartus&#39;</span><span class="p">]:</span>

    <span class="n">hmodel</span> <span class="o">=</span> <span class="n">hls4ml</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">convert_from_keras_model</span><span class="p">(</span>
        <span class="n">kmodel</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;hls4mlprj_extensions_</span><span class="si">{</span><span class="n">backend_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
        <span class="n">backend</span><span class="o">=</span><span class="n">backend_id</span><span class="p">,</span>
        <span class="n">io_type</span><span class="o">=</span><span class="s1">&#39;io_parallel&#39;</span><span class="p">,</span>
        <span class="n">hls_config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Model&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Precision&#39;</span><span class="p">:</span> <span class="s1">&#39;ap_int&lt;6&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;ReuseFactor&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
    <span class="p">)</span>

    <span class="n">hmodel</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
    <span class="n">hres</span> <span class="o">=</span> <span class="n">hmodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">))</span>

    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span><span class="n">kres</span><span class="p">,</span> <span class="n">hres</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="fifo_depth.html" class="btn btn-neutral float-left" title="FIFO Buffer Depth Optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../autodoc/hls4ml.backends.html" class="btn btn-neutral float-right" title="hls4ml.backends package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Fast Machine Learning Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>